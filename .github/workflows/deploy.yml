name: "Initial Test Deployment Workflow"

description: "Workflow to deploy to production and verify deployment"
on:
  push: 
    branches: ["main"]

jobs: 
  deploy-to-prod:
    runs-on: ubuntu-latest

    outputs:
      first_job: ${{ steps.finalStep.outputs.externalVariable }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node
        run: npm install

      - name: Run Test
        run: npm run test

      - name: Share result with another job
        id: finalStep
        run: echo "externalVariable=Hola" >> $GITHUB_OUTPUT

      - name: Take variable value
        if: ${{ steps.finalStep.outputs.externalVariable == 'Hola' }}
        run: echo "Value sucessfully taked = ${{ steps.finalStep.outputs.externalVariable }}"

  verify-deploy:
    runs-on: ubuntu-latest
    needs: deploy-to-prod

    env:
      NODE_ENV: production
      GITHUB_TOKEN: secretToken123
      FIRST_JOB_VALUE: ${{ needs.deploy-to-prod.outputs.first_job }}

    steps:
      - name: Verify deployment
        run: echo "Verified Step"

      - name:
        if: ${{ env.FIRST_JOB_VALUE == 'Hola' }}
        run: echo "Sucessfully context = ${{ env.FIRST_JOB_VALUE }}"
      
      - name: Notify success
        if: ${{ env.NODE_ENV == 'production' }}
        run: echo "Deployment successful"